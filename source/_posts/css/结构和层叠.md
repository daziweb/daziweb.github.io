---
title: 特殊性、继承和层叠
tags:
  - CSS
categories:
  - 书籍阅读
comments: true
---

## 特殊性

选择器的特殊性由选择器本身的组件确定。特殊性值表述为 4 个部分，如：0，0，0，0。一个选择器的具体特殊性如下确定：

- 对于选择器中给定的各个 ID 属性值，加 0，1，0，0
- 对于选择器中给定的各个类属性值、属性选择或伪类，加 0，0，1，0
- 对于选择器中给定的各个元素和伪元素，加 0，0，0，1
- 结合符和通配选择器对特殊性没有任何贡献

<!--more-->

```css
h1 {
  color: red; /* specificity = 0001 */
}

p em {
  color: purple; /* specificity = 0002 */
}

.grape {
  color: purple; /* specificity = 0010 */
}

*.bright {
  color: yellow; /* specificity = 0010 */
}

p.bright em.dark {
  color: maroon; /* specificity = 0022 */
}

#id216 {
  color: blue; /* specificity = 0100 */
}

div#sidebar *[href] {
  color: silver; /* specificity = 0111 */
}
```

### 通配选择器特殊性

通配选择器对一个选择器的特殊性没有贡献。特殊性可理解为 0，0，0，0。

```css
div p {
  color: black; /* 0,0,0,2 */
}

* {
  color: gray; /* 0,0,0,0 */
}

body * strong {
  color: blue; /* 0,0,0,2 */
}
```

### ID 和属性选择器的特殊性

ID 选择器和指定 id 属性的属性选择器在特殊性上有所不同。

```css
html > body table tr[id='totals'] td ul > li {
  color: maroon; /* 0,0,1,7 */
}

li#answer {
  color: navy; /* 0,1,0,1 */
}

#meadow {
  color: green; /* 0,1,0,0 */
}

*[id='meadow'] {
  color: red; /* 0,0,1,0 */
}
```

### 内联样式特殊性

每个内联样式声明的特殊性都是 1，0，0，0。这意味着，即使有 id 属性的元素与某个规则匹配，也必须遵循内联样式声明。

### 重要性

有时某个声明可能非常重要，超过了所有其他声明。允许在这些声明的结束分号之前插入 `!important` 来标志。

```css
p.dark {
  color: #333 !important;
  background: white !important;
}
```

## 继承

基于继承机制，样式不仅应用到指定的元素，还会应用到它的后代元素。声明值会沿着 DOM 树向下传播到后代元素，并一直继续，直到再没有更多的后代元素继承这个值为止。值绝对不会向上传播，也就是说，元素不会把值向上传递到其祖先。
**注意 1：在 HTML 中，对于向上传播规则有一个例外，应用到 body 元素的背景样式可以传递到 html 元素(html 是文档的根元素)，相应地可以定义其画布。**
**注意 2：有些属性不能继承，一般地大多数模型属性(包括外边距、内边距、背景和边框)都不能继承。**

继承的值根本没有特殊性，甚至连 0 特殊性都没有。这种差别绝不能忽视。

```css
/* <h1 id="page-title">mark(红色) <em>center(黄色)</em></h1> */
/* <p>123(黄色)</p> */
* {
  color: yellow;
}

h1#page-title {
  color: red;
}
```

因为通配选择器适用于所有元素，而且有 0 特殊性，其颜色指定的值 yellow 要优先于继承值 red，因为继承值根本没有特殊性。因些，em 元素会显示为黄色而不是红色。

## 层叠

如果特殊性相等的两个规则同时应用到同一个元素会怎么样呢？浏览器如何解决这个冲突？

```css
h1 {
  color: red; /* 0,0,0,1 */
}

h1 {
  color: blue; /* 0,0,0,1 */
}
```

层叠规则如下：

1. 找出所有相关的规则，这些规则都包含与一个给定元素匹配的选择器。
2. 按显式权重对应用到该元素的所有声明排序。标志 `！important` 的规则的权重要高于没有 `!important` 标志的规则。按来源对应用到给定元素的所有声明排序。共 3 种来源：创作人员、读者和用户代理。正常情况下，创作人员的样式要胜过读者的样式。有 `!important` 标志的读者样式要强于所有其他样式，这包括有 `!important` 标志的创作人员样式。创作人员样式和读者样式都比用户代理的默认样式要强。
3. 按特殊性对应用到给定元素的所有声明排序。有较高特殊性的元素权重要大于有较低特殊性的元素。
4. 按出现顺序对应用到给定元素的所有声明排序。一个声明在样式表或文档中越后出现，它的权重就越大。如果样式表中有导入的样式表，一般认为出现在导入样式表中的声明在前，主样式表中的所有声明在后。

### 按权重和来源排序

根据第 2 条规则，如果两个样式规则应用到同一个元素，而且其中一个规则有 `!important` 标志，这个重要规则将胜出：

```css
p {
  color: gray !important; /* 应用 */
}
```

```html
<p style="color: black;">Well, <em>hello</em> there!</p>
```

另外，还要考虑规则的来源。如果一个元素与创作人员样式表中的正常权重样式匹配，另外还与读者样式表中的正常权重样式匹配，则会使用创作人员的样式。

```css
p em {
  color: black; /* author style sheet 应用 */
}

p em {
  color: yellow; /* reader style sheet */
}
```

如果两个规则都标志有 `!important`。

```css
p em {
  color: black; /* author style sheet */
}

p em {
  color: yellow; /* reader style sheet 应用 */
}
```

一般地，用户代理的默认样式(通常受用户首选项的影响)也要考虑在内。默认样式声明在所有声明当中影响最小。

声明的权重顺序由大到小：

- 1.读者的重要声明
- 2.创作人员的重要声明
- 3.创作人员的正常声明
- 4.读者的正常声明
- 5.用户代理声明

### 按特殊性排序

根据第 3 条规则，如果向一个元素应用多个彼此冲突的声明，而且它们的权重相同，则要按特殊性排序，最特殊的声明最优选。

```html
<p id="bright">Well, hello there!</p>
```

```css
p#bright {
  color: silver; /* 0,1,0,1 应用 */
}
p {
  color: black; /* 0,0,0,1 */
}
```

### 按顺序排序

根据第 4 条规则，如果两个规则的权重、来源和特殊性完全相同，那么在样式表中后出现的一个会胜出。

```css
h1 {
  color: red; /* 0,0,0,1 */
}

h1 {
  color: blue; /* 0,0,0,1 应用 */
}
```
