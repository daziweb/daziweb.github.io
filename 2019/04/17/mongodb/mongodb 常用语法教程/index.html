<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x321.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x161.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="mongodb,">





  <link rel="alternate" href="/atom.xml" title="Dazi-World" type="application/atom+xml">






<meta name="description" content="创建数据库MongoDB use DATABASE_NAME 用于创建数据库。该命令如果数据库不存在，将创建一个新的数据库， 否则将返回现有的数据库。 语法use DATABASE语句的基本语法如下： 1use DATABASE_NAME 例子：如果想创建一个数据库名称为 \， 那么 use DATABASE 语句应该如下： 12&amp;gt;use mydbswitched to db mydb 要检">
<meta name="keywords" content="mongodb">
<meta property="og:type" content="article">
<meta property="og:title" content="mongodb 常用语法教程">
<meta property="og:url" content="https://daziweb.github.io/2019/04/17/mongodb/mongodb 常用语法教程/index.html">
<meta property="og:site_name" content="Dazi-World">
<meta property="og:description" content="创建数据库MongoDB use DATABASE_NAME 用于创建数据库。该命令如果数据库不存在，将创建一个新的数据库， 否则将返回现有的数据库。 语法use DATABASE语句的基本语法如下： 1use DATABASE_NAME 例子：如果想创建一个数据库名称为 \， 那么 use DATABASE 语句应该如下： 12&amp;gt;use mydbswitched to db mydb 要检">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gk1gxifj20dw0bd74v.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gpmm3kij20it08aaar.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gsbqq7cj20it0cq0tu.jpg">
<meta property="og:updated_time" content="2019-04-17T03:26:25.277Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mongodb 常用语法教程">
<meta name="twitter:description" content="创建数据库MongoDB use DATABASE_NAME 用于创建数据库。该命令如果数据库不存在，将创建一个新的数据库， 否则将返回现有的数据库。 语法use DATABASE语句的基本语法如下： 1use DATABASE_NAME 例子：如果想创建一个数据库名称为 \， 那么 use DATABASE 语句应该如下： 12&amp;gt;use mydbswitched to db mydb 要检">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gk1gxifj20dw0bd74v.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://daziweb.github.io/2019/04/17/mongodb/mongodb 常用语法教程/">





  <title>mongodb 常用语法教程 | Dazi-World</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?24791f8d2ad1a57879a0db6fae0a3309";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a style="position: absolute; right: 0; border-bottom: none; z-index: 100;" href="https://github.com/daziweb">
      <img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_red_aa0000.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1">
    </a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dazi-World</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">黄昏恬静到三更</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daziweb.github.io/2019/04/17/mongodb/mongodb 常用语法教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dazi">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dazi-World">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">mongodb 常用语法教程</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-17T09:35:58+08:00">
                2019-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongodb/" itemprop="url" rel="index">
                    <span itemprop="name">mongodb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/17/mongodb/mongodb 常用语法教程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/04/17/mongodb/mongodb 常用语法教程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/04/17/mongodb/mongodb 常用语法教程/" class="leancloud_visitors" data-flag-title="mongodb 常用语法教程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><p>MongoDB use DATABASE_NAME 用于创建数据库。该命令如果数据库不存在，将创建一个新的数据库， 否则将返回现有的数据库。</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><p>use DATABASE语句的基本语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use DATABASE_NAME</span><br></pre></td></tr></table></figure>
<h5 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h5><p>如果想创建一个数据库名称为 <strong>\<mydb></mydb></strong>， 那么 <strong>use DATABASE</strong> 语句应该如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;use mydb</span><br><span class="line">switched to db mydb</span><br></pre></td></tr></table></figure>
<p>要检查当前选择的数据库使用命令 <strong>db</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;db</span><br><span class="line">mydb</span><br></pre></td></tr></table></figure>
<p>如果想查询数据库列表，那么使用命令 <strong>show dbs</strong>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;show dbs</span><br><span class="line">local     <span class="number">0.78125</span>GB</span><br><span class="line">test      <span class="number">0.23012</span>GB</span><br></pre></td></tr></table></figure>
<p>所创建的数据库（mydb）不存在于列表中。要显示的数据库，需要至少插入一个文档进去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.movie.insert(&#123;<span class="string">"name"</span>:<span class="string">"yiibai tutorials"</span>&#125;)</span><br><span class="line">&gt;show dbs</span><br><span class="line">local      <span class="number">0.78125</span>GB</span><br><span class="line">mydb       <span class="number">0.23012</span>GB</span><br><span class="line">test       <span class="number">0.23012</span>GB</span><br></pre></td></tr></table></figure>
<p><strong>MongoDB的默认数据库是test。 如果没有创建任何数据库，那么集合将被保存在测试数据库。</strong></p>
<a id="more"></a>
<h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><p>MongoDB db.dropDatabase() 命令用于删除现有的数据库。</p>
<h5 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h5><p>dropDatabase()指令的基本语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure>
<p>这将删除选定的数据库。如果没有选择任何数据库，那么它会删除默认的“test”数据库</p>
<h5 id="例子：-1"><a href="#例子：-1" class="headerlink" title="例子："></a>例子：</h5><p>如果想删除新的数据库 <strong>\<mydb></mydb></strong>, 那么 <strong>dropDatabase()</strong> 命令将如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;use mydb</span><br><span class="line">switched to db mydb</span><br><span class="line">&gt;db.dropDatabase()</span><br><span class="line">&gt;&#123; <span class="string">"dropped"</span> : <span class="string">"mydb"</span>, <span class="string">"ok"</span> : <span class="number">1</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h2><p>MongoDB 的 db.createCollection(name, options) 用于创建集合。 在命令中, name 是要创建集合的名称。 Options 是一个文档，用于指定集合的配置</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>String</td>
<td>要创建的集合的名称</td>
</tr>
<tr>
<td>OPtions</td>
<td>Document</td>
<td>（可选）指定有关内存大小和索引选项</td>
</tr>
</tbody>
</table>
<p>选项参数是可选的，所以需要指定集合的唯一名字。</p>
<h5 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h5><p>createCollection()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;use test</span><br><span class="line">switched to db test</span><br><span class="line">&gt;db.createCollection(<span class="string">"mycollection"</span>)</span><br><span class="line">&#123; <span class="string">"ok"</span> : <span class="number">1</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>可以通过使用 <strong>show collections</strong> 命令来检查创建的集合</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;show collections</span><br><span class="line">mycollection</span><br><span class="line">system.indexes</span><br></pre></td></tr></table></figure>
<h5 id="选项列表"><a href="#选项列表" class="headerlink" title="选项列表"></a>选项列表</h5><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>capped</td>
<td>Boolean</td>
<td>（可选）如果为true，它启用上限集合。上限集合是一个固定大小的集合，当它达到其最大尺寸会自动覆盖最老的条目。 如果指定true，则还需要指定参数的大小。</td>
</tr>
<tr>
<td>autoIndexID</td>
<td>Boolean</td>
<td>（可选）如果为true，自动创建索引_id字段。默认的值是 false.</td>
</tr>
<tr>
<td>size</td>
<td>number</td>
<td>（可选）指定的上限集合字节的最大尺寸。如果capped 是true，那么还需要指定这个字段。</td>
</tr>
<tr>
<td>max</td>
<td>number</td>
<td>（可选）指定上限集合允许的最大文件数。</td>
</tr>
</tbody>
</table>
<p>尽管插入文档，MongoDB首先检查字段集合的上限大小，那么它会检查最大字段。</p>
<h5 id="语法-3"><a href="#语法-3" class="headerlink" title="语法:"></a>语法:</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createCollection(<span class="string">"mycol"</span>, &#123; <span class="attr">capped</span> : <span class="literal">true</span>, <span class="attr">autoIndexID</span> : <span class="literal">true</span>, <span class="attr">size</span> : <span class="number">6142800</span>, <span class="attr">max</span> : <span class="number">10000</span> &#125; )</span><br><span class="line">&#123; <span class="string">"ok"</span> : <span class="number">1</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>在MongoDB中并不需要创建集合。 当插入一些文档 MongoDB 会自动创建集合。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.yiibai.insert(&#123;<span class="string">"name"</span> : <span class="string">"yiibai"</span>&#125;)</span><br><span class="line">&gt;show collections</span><br><span class="line">mycol</span><br><span class="line">mycollection</span><br><span class="line">system.indexes</span><br><span class="line">yiibai</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h2><p>MongoDB 的 db.collection.drop() 用于从数据库中删除集合。</p>
<h5 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h5><p>drop() 命令的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.drop()</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">##### 例子</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">下面给出的例子将删除给定名称的集合：**mycollection**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span> javascript</span><br><span class="line">&gt;use mydb</span><br><span class="line">switched to db mydb</span><br><span class="line">&gt;db.mycollection.drop()</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="插入文档"><a href="#插入文档" class="headerlink" title="插入文档"></a>插入文档</h2><p>将数据插入到MongoDB集合，需要使用MongoDB 的 insert() 方法。</p>
<h5 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h5><p>insert()命令的基本语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.insert(<span class="built_in">document</span>)</span><br></pre></td></tr></table></figure>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.insert(&#123;</span><br><span class="line">   _id: ObjectId(<span class="number">7</span>df78ad8902c),</span><br><span class="line">   title: <span class="string">'MongoDB Overview'</span>, </span><br><span class="line">   description: <span class="string">'MongoDB is no sql database'</span>,</span><br><span class="line">   by: <span class="string">'yiibai tutorials'</span>,</span><br><span class="line">   url: <span class="string">'http://www.yiibai.com'</span>,</span><br><span class="line">   tags: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   likes: <span class="number">100</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这里 mycol 是我们的集合名称，它是在之前的教程中创建。如果集合不存在于数据库中，那么MongoDB创建此集合，然后插入文档进去。</p>
<p>在如果我们不指定_id参数插入的文档，那么 MongoDB 将为文档分配一个唯一的ObjectId。</p>
<p>_id 是12个字节十六进制数在一个集合的每个文档是唯一的。 12个字节被划分如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_id: ObjectId(<span class="number">4</span> bytes timestamp, <span class="number">3</span> bytes machine id, <span class="number">2</span> bytes process id, <span class="number">3</span> bytes incrementer)</span><br></pre></td></tr></table></figure>
<p>要以单个查询插入多个文档，可以通过文档 insert() 命令的数组方式。</p>
<h5 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.post.insert([</span><br><span class="line">&#123;</span><br><span class="line">   title: <span class="string">'MongoDB Overview'</span>, </span><br><span class="line">   description: <span class="string">'MongoDB is no sql database'</span>,</span><br><span class="line">   by: <span class="string">'yiibai tutorials'</span>,</span><br><span class="line">   url: <span class="string">'http://www.yiibai.com'</span>,</span><br><span class="line">   tags: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   likes: <span class="number">100</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">   title: <span class="string">'NoSQL Database'</span>, </span><br><span class="line">   description: <span class="string">'NoSQL database doesn'</span>t have tables<span class="string">',</span></span><br><span class="line"><span class="string">   by: '</span>yiibai tutorials<span class="string">',</span></span><br><span class="line"><span class="string">   url: '</span>http:<span class="comment">//www.yiibai.com',</span></span><br><span class="line">   tags: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   likes: <span class="number">20</span>, </span><br><span class="line">   comments: [	</span><br><span class="line">      &#123;</span><br><span class="line">         user:<span class="string">'user1'</span>,</span><br><span class="line">         message: <span class="string">'My first comment'</span>,</span><br><span class="line">         dateCreated: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2013</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">35</span>),</span><br><span class="line">         like: <span class="number">0</span> </span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h2 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h2><p>要从集合查询MongoDB数据，需要使用MongoDB的 find()方法。</p>
<h5 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h5><p>find()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.find()</span><br></pre></td></tr></table></figure>
<p>find() 方法将在非结构化的方式显示所有的文件。 如果显示结果是格式化的，那么可以用pretty() 方法。</p>
<h5 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find().pretty()</span><br></pre></td></tr></table></figure>
<h5 id="例子-2"><a href="#例子-2" class="headerlink" title="例子"></a>例子</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"_id"</span>: ObjectId(<span class="number">7</span>df78ad8902c),</span><br><span class="line">   <span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>, </span><br><span class="line">   <span class="string">"description"</span>: <span class="string">"MongoDB is no sql database"</span>,</span><br><span class="line">   <span class="string">"by"</span>: <span class="string">"yiibai tutorials"</span>,</span><br><span class="line">   <span class="string">"url"</span>: <span class="string">"http://www.yiibai.com"</span>,</span><br><span class="line">   <span class="string">"tags"</span>: [<span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"NoSQL"</span>],</span><br><span class="line">   <span class="string">"likes"</span>: <span class="string">"100"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>除了find()方法还有findOne()方法，仅返回一个文档。</p>
<h5 id="RDBMS-Where子句等效于MongoDB"><a href="#RDBMS-Where子句等效于MongoDB" class="headerlink" title="RDBMS Where子句等效于MongoDB"></a>RDBMS Where子句等效于MongoDB</h5><p>查询文档在一些条件的基础上，可以使用下面的操作</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>语法</th>
<th>示例</th>
<th>RDBMS等效语句</th>
</tr>
</thead>
<tbody>
<tr>
<td>Equality</td>
<td>{<key>:<value>}</value></key></td>
<td>db.mycol.find({“by”:”yiibai tutorials”}).pretty()</td>
<td>where by 等于 ‘yiibai tutorials’</td>
</tr>
<tr>
<td>Less Than</td>
<td><key>:{$lt:<value>}}</value></key></td>
<td>db.mycol.find({“likes”:{$lt:50}}).pretty()</td>
<td>where likes 小于 50</td>
</tr>
<tr>
<td>Less Than Equals</td>
<td>{<key>:{$lte:<value>}}</value></key></td>
<td>db.mycol.find({“likes”:{$lte:50}}).pretty()</td>
<td>where likes 小于等于 50</td>
</tr>
<tr>
<td>Greater Than</td>
<td>{<key>:{$gt:<value>}}</value></key></td>
<td>db.mycol.find({“likes”:{$gt:50}}).pretty()</td>
<td>where likes 大于 50</td>
</tr>
<tr>
<td>Greater Than Equals</td>
<td>{<key>:{$gte:<value>}}</value></key></td>
<td>db.mycol.find({“likes”:{$gte:50}}).pretty()</td>
<td>where likes 大于等于 50</td>
</tr>
<tr>
<td>Not Equals</td>
<td>{<key>:{$ne:<value>}}</value></key></td>
<td>db.mycol.find({“likes”:{$ne:50}}).pretty()</td>
<td>where likes 不等于 50</td>
</tr>
</tbody>
</table>
<h5 id="AND-在-MongoDB"><a href="#AND-在-MongoDB" class="headerlink" title="AND 在 MongoDB"></a>AND 在 MongoDB</h5><h5 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h5><p>在 find()方法，如果您传递多个键通过”,”将它们分开，那么MongoDB对待它就如AND条件一样。基本语法如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;<span class="attr">key1</span>:value1, <span class="attr">key2</span>:value2&#125;).pretty()</span><br></pre></td></tr></table></figure>
<h5 id="例子-3"><a href="#例子-3" class="headerlink" title="例子"></a>例子</h5><p>下面给出的例子将显示所有教程含“yiibai tutorials”和其标题是“MongoDB Overview”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;<span class="string">"by"</span>:<span class="string">"yiibai tutorials"</span>,<span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>&#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"_id"</span>: ObjectId(<span class="number">7</span>df78ad8902c),</span><br><span class="line">   <span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>, </span><br><span class="line">   <span class="string">"description"</span>: <span class="string">"MongoDB is no sql database"</span>,</span><br><span class="line">   <span class="string">"by"</span>: <span class="string">"yiibai tutorials"</span>,</span><br><span class="line">   <span class="string">"url"</span>: <span class="string">"http://www.yiibai.com"</span>,</span><br><span class="line">   <span class="string">"tags"</span>: [<span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"NoSQL"</span>],</span><br><span class="line">   <span class="string">"likes"</span>: <span class="string">"100"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>对于上面给出的例子相当于where子句：’ where by=’yiibai tutorials’ AND title=’MongoDB Overview’ ‘。可以传递任何数目的键-值对在find子句。</p>
<h5 id="OR-在-MongoDB"><a href="#OR-在-MongoDB" class="headerlink" title="OR 在 MongoDB"></a>OR 在 MongoDB</h5><h5 id="语法-9"><a href="#语法-9" class="headerlink" title="语法"></a>语法</h5><p>要查询基于OR条件的文件，需要使用$or关键字。OR的基本语法如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(</span><br><span class="line">   &#123;</span><br><span class="line">      $or: [</span><br><span class="line">	     &#123;<span class="attr">key1</span>: value1&#125;, &#123;<span class="attr">key2</span>:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br></pre></td></tr></table></figure>
<h5 id="例子-4"><a href="#例子-4" class="headerlink" title="例子"></a>例子</h5><p>下面给出的例子将显示所有撰写含有 ‘yiibai tutorials’ 或是标题为 ‘MongoDB Overview’ 的教程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;<span class="attr">$or</span>:[&#123;<span class="string">"by"</span>:<span class="string">"tutorials point"</span>&#125;,&#123;<span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>&#125;]&#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"_id"</span>: ObjectId(<span class="number">7</span>df78ad8902c),</span><br><span class="line">   <span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>, </span><br><span class="line">   <span class="string">"description"</span>: <span class="string">"MongoDB is no sql database"</span>,</span><br><span class="line">   <span class="string">"by"</span>: <span class="string">"yiibai tutorials"</span>,</span><br><span class="line">   <span class="string">"url"</span>: <span class="string">"http://www.yiibai.com"</span>,</span><br><span class="line">   <span class="string">"tags"</span>: [<span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"NoSQL"</span>],</span><br><span class="line">   <span class="string">"likes"</span>: <span class="string">"100"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h5 id="使用-AND-和-OR-在一起"><a href="#使用-AND-和-OR-在一起" class="headerlink" title="使用 AND 和 OR 在一起"></a>使用 AND 和 OR 在一起</h5><h5 id="例子-5"><a href="#例子-5" class="headerlink" title="例子"></a>例子</h5><p>下面给出的例子显示有喜欢数大于100 的文档，其标题要么是 ‘MongoDB Overview’ 或 ‘yiibai tutorials’. 等效于SQL的where子句：<strong>‘where likes&gt;10 AND (by = ‘yiibai tutorials’ OR title = ‘MongoDB Overview’)’</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(<span class="string">"likes"</span>: &#123;<span class="attr">$gt</span>:<span class="number">10</span>&#125;, <span class="attr">$or</span>: [&#123;<span class="string">"by"</span>: <span class="string">"yiibai tutorials"</span>&#125;, &#123;<span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>&#125;] &#125;).pretty()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"_id"</span>: ObjectId(<span class="number">7</span>df78ad8902c),</span><br><span class="line">   <span class="string">"title"</span>: <span class="string">"MongoDB Overview"</span>, </span><br><span class="line">   <span class="string">"description"</span>: <span class="string">"MongoDB is no sql database"</span>,</span><br><span class="line">   <span class="string">"by"</span>: <span class="string">"yiibai tutorials"</span>,</span><br><span class="line">   <span class="string">"url"</span>: <span class="string">"http://www.yiibai.com"</span>,</span><br><span class="line">   <span class="string">"tags"</span>: [<span class="string">"mongodb"</span>, <span class="string">"database"</span>, <span class="string">"NoSQL"</span>],</span><br><span class="line">   <span class="string">"likes"</span>: <span class="string">"100"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h2><p>MongoDB的update()和save()方法用于更新文档到一个集合。 update()方法将现有的文档中的值更新，而save()方法使用传递到save()方法的文档替换现有的文档。</p>
<h5 id="MongoDB-Update-方法"><a href="#MongoDB-Update-方法" class="headerlink" title="MongoDB Update() 方法"></a>MongoDB Update() 方法</h5><h5 id="语法-10"><a href="#语法-10" class="headerlink" title="语法"></a>语法</h5><p>update()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.update(SELECTIOIN_CRITERIA, UPDATED_DATA)</span><br></pre></td></tr></table></figure>
<h5 id="例子-6"><a href="#例子-6" class="headerlink" title="例子"></a>例子</h5><p>考虑mycol集合有如下数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>下面的例子将设置其标题“MongoDB Overview”的文件为新标题为“New MongoDB Tutorial”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.update(&#123;<span class="string">'title'</span>:<span class="string">'MongoDB Overview'</span>&#125;,&#123;<span class="attr">$set</span>:&#123;<span class="string">'title'</span>:<span class="string">'New MongoDB Tutorial'</span>&#125;&#125;)</span><br><span class="line">&gt;db.mycol.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"New MongoDB Tutorial"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Tutorial Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>默认情况下，MongoDB将只更新单一文件，更新多，需要一个参数 ‘multi’ 设置为 true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.update(&#123;<span class="string">'title'</span>:<span class="string">'MongoDB Overview'</span>&#125;,&#123;<span class="attr">$set</span>:&#123;<span class="string">'title'</span>:<span class="string">'New MongoDB Tutorial'</span>&#125;&#125;,&#123;<span class="attr">multi</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="MongoDB-Save-方法"><a href="#MongoDB-Save-方法" class="headerlink" title="MongoDB Save() 方法"></a>MongoDB Save() 方法</h5><p>save() 方法取代，通过新文档到 save()方法</p>
<h5 id="语法-11"><a href="#语法-11" class="headerlink" title="语法"></a>语法</h5><p>mongodb 的 save()方法如下所示的基本语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.save(&#123;<span class="attr">_id</span>:ObjectId(),NEW_DATA&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="例子-7"><a href="#例子-7" class="headerlink" title="例子"></a>例子</h5><p>下面的例子将替换该文件_id ‘5983548781331adf45ec7’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.save(</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai New Topic"</span>, <span class="string">"by"</span>:<span class="string">"Yiibai Yiibai"</span></span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line">&gt;db.mycol.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai New Topic"</span>, <span class="string">"by"</span>:<span class="string">"Yiibai Yiibai"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h2><p>MongoDB 的 <strong>remove()</strong>方法用于从集合中删除文档。remove()方法接受两个参数。一个是标准缺失，第二是justOne标志</p>
<ul>
<li><strong>deletion criteria</strong> : 根据文件（可选）删除条件将被删除。</li>
<li><strong>justOne</strong> : （可选）如果设置为true或1，然后取出只有一个文档。</li>
</ul>
<h5 id="语法-12"><a href="#语法-12" class="headerlink" title="语法"></a>语法</h5><p><strong>remove()</strong>方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.remove(DELLETION_CRITTERIA)</span><br></pre></td></tr></table></figure>
<h5 id="例子-8"><a href="#例子-8" class="headerlink" title="例子"></a>例子</h5><p>考虑mycol集合有如下数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>下面的例子将删除所有的文件，其标题为 ‘MongoDB Overview’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.remove(&#123;<span class="string">'title'</span>:<span class="string">'MongoDB Overview'</span>&#125;)</span><br><span class="line">&gt;db.mycol.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Toturials Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h5 id="只删除一个"><a href="#只删除一个" class="headerlink" title="只删除一个"></a>只删除一个</h5><p>如果有多个记录，并要删除仅第一条记录，然后在 remove()方法设置参数 justOne 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.remove(DELETION_CRITERIA,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h5 id="删除所有文件"><a href="#删除所有文件" class="headerlink" title="删除所有文件"></a>删除所有文件</h5><p>如果没有指定删除条件，则MongoDB将从集合中删除整个文件。这相当于SQL的 truncate 命令。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.remove()</span><br><span class="line">&gt;db.mycol.find()</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h2 id="MongoDB投影"><a href="#MongoDB投影" class="headerlink" title="MongoDB投影"></a>MongoDB投影</h2><p>mongodb投影意义是只选择需要的数据，而不是选择整个一个文档的数据。如果一个文档有5个字段，只需要显示3个，只从中选择3个字段。</p>
<p>MongoDB的find()方法，解释了MongoDB中查询文档接收的第二个可选的参数是要检索的字段列表。在MongoDB中，当执行find()方法，那么它会显示一个文档的所有字段。要限制这一点，需要设置字段列表值为1或0。1是用来显示字段，而0被用来隐藏字段。</p>
<h5 id="语法-13"><a href="#语法-13" class="headerlink" title="语法"></a>语法</h5><p>find()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.find(&#123;&#125;,&#123;<span class="attr">KEY</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="例子-9"><a href="#例子-9" class="headerlink" title="例子"></a>例子</h5><p>考虑集合 <strong>myycol</strong> 有下列数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>下面的例子将显示文档的标题，在查询文档时。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;&#125;,&#123;<span class="string">"title"</span>:<span class="number">1</span>,<span class="attr">_id</span>:<span class="number">0</span>&#125;)</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p><strong>请注意在执行find()方法时_id字段始终显示，如果不想要显示这个字段，那么需要将其设置为0</strong></p>
<h2 id="限制文档"><a href="#限制文档" class="headerlink" title="限制文档"></a>限制文档</h2><h5 id="MongoDB-Limit-方法"><a href="#MongoDB-Limit-方法" class="headerlink" title="MongoDB Limit() 方法"></a>MongoDB Limit() 方法</h5><p>要在MongoDB中限制记录，需要使用limit()方法。 limit() 方法接受一个数字类型的参数，这是要显示的文档数量。</p>
<h5 id="语法-14"><a href="#语法-14" class="headerlink" title="语法"></a>语法</h5><p>limit()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.find().limit(NUMBER)</span><br></pre></td></tr></table></figure>
<h5 id="例子-10"><a href="#例子-10" class="headerlink" title="例子"></a>例子</h5><p>考虑集合 myycol 有下列数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>下面的例子将只显示2个文档，在查询文档时。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;&#125;,&#123;<span class="string">"title"</span>:<span class="number">1</span>,<span class="attr">_id</span>:<span class="number">0</span>&#125;).limit(<span class="number">2</span>)</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>如果不指定 <strong>limit()</strong> 方法的参数数量，然后它会显示集合中的所有文档。</p>
<h5 id="MongoDB-Skip-方法"><a href="#MongoDB-Skip-方法" class="headerlink" title="MongoDB Skip() 方法"></a>MongoDB Skip() 方法</h5><p>除了 <strong>limit()</strong> 方法还有一个方法 <strong>skip()</strong> 也接受数字类型参数并用于跳过文件数。</p>
<h5 id="语法-15"><a href="#语法-15" class="headerlink" title="语法"></a>语法</h5><p>skip() 方法的基础语法如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)</span><br></pre></td></tr></table></figure>
<h5 id="例子-11"><a href="#例子-11" class="headerlink" title="例子"></a>例子</h5><p>下面的例子将仅显示第二个文档。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;&#125;,&#123;<span class="string">"title"</span>:<span class="number">1</span>,<span class="attr">_id</span>:<span class="number">0</span>&#125;).limit(<span class="number">1</span>).skip(<span class="number">1</span>)</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p><strong>请注意，skip() 方法的默认值是 0</strong></p>
<h2 id="文档排序"><a href="#文档排序" class="headerlink" title="文档排序"></a>文档排序</h2><p>要排序MongoDB中的文档，需要使用 sort()方法。 sort() 方法接受一个包含字段列表以及排序顺序的文档。 要使用1和-1指定排序顺序。1用于升序，而-1是用于降序。</p>
<h5 id="语法-16"><a href="#语法-16" class="headerlink" title="语法"></a>语法</h5><p>sort()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.find().sort(&#123;<span class="attr">KEY</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="例子-12"><a href="#例子-12" class="headerlink" title="例子"></a>例子</h5><p>考虑集合 myycol 有如下数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec5), <span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec6), <span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="number">5983548781331</span>adf45ec7), <span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>下面的例子将显示的文件排序按标题降序排序。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.find(&#123;&#125;,&#123;<span class="string">"title"</span>:<span class="number">1</span>,<span class="attr">_id</span>:<span class="number">0</span>&#125;).sort(&#123;<span class="string">"title"</span>:<span class="number">-1</span>&#125;)</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"Yiibai Yiibai Overview"</span>&#125;</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"NoSQL Overview"</span>&#125;</span><br><span class="line">&#123;<span class="string">"title"</span>:<span class="string">"MongoDB Overview"</span>&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p><strong>请注意，如果不指定排序类型，那么 sort() 方法将以升序排列文档。</strong></p>
<h2 id="MongoDB索引"><a href="#MongoDB索引" class="headerlink" title="MongoDB索引"></a>MongoDB索引</h2><p>索引支持查询高效率执行。如果没有索引，MongoDB必须扫描集合中的每一个文档，然后选择那些符合查询语句的文档。若需要 mongod 来处理大量数据，扫描是非常低效的。</p>
<p>索引是特殊的数据结构，存储在一个易于设置遍历形式的数据的一小部分。索引存储在索引中指定特定字段的值或一组字段，并排序字段的值。</p>
<p>要创建索引，需要使用MongoDB的ensureIndex()方法。</p>
<h5 id="语法-17"><a href="#语法-17" class="headerlink" title="语法"></a>语法</h5><p>ensureIndex()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.ensureIndex(&#123;<span class="attr">KEY</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>这里键是要创建索引字段，1是按名称升序排序。若以按降序创建索引，需要使用 -1.</p>
<h5 id="例子-13"><a href="#例子-13" class="headerlink" title="例子"></a>例子</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.ensureIndex(&#123;<span class="string">"title"</span>:<span class="number">1</span>&#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>在 ensureIndex()方法，可以通过多个字段，来创建多个字段索引。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.mycol.ensureIndex(&#123;<span class="string">"title"</span>:<span class="number">1</span>,<span class="string">"description"</span>:<span class="number">-1</span>&#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p><strong>ensureIndex()</strong> 方法还接受选项列表（这是可选），其列表如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>background</td>
<td>Boolean</td>
<td>构建索引在后台以便建立索引不阻止其它数据库活动。指定true时建立在后台。缺省值是false.</td>
</tr>
<tr>
<td>unique</td>
<td>Boolean</td>
<td>创建一个唯一的索引，以使集合将不接受插入的的文档，其中的索引关键字或键匹配索引的现有值。指定true以创建唯一索引。缺省值是 false.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>索引的名称。如果未指定，MongoDB通过连接索引的字段和排序顺序的名称生成一个索引名。</td>
</tr>
<tr>
<td>dropDups</td>
<td>Boolean</td>
<td>创建一个字段唯一索引时可能会有重复。MongoDB索引键仅第一次出现，并从集合中删除包含该键后续出现的所有文档。指定true以创建唯一索引。缺省值是 false.</td>
</tr>
<tr>
<td>sparse</td>
<td>Boolean</td>
<td>如果为true，索引只引用与指定的字段的文档。这些索引使用更少的空间，但在某些情况下表现不同（特别是排序）。缺省值是 false.</td>
</tr>
<tr>
<td>expireAfterSeconds</td>
<td>integer</td>
<td>指定的值，以秒为单位，作为一个TTL控制MongoDB保留在此集合文件多久。</td>
</tr>
<tr>
<td>v</td>
<td>index version</td>
<td>索引版本号。默认的索引版本取决于mongod创建索引时运行的版本。</td>
</tr>
<tr>
<td>weights</td>
<td>document</td>
<td>重量（weight ）是一个数字，它是从1至99,999的数字，表示字段相对于其它索引字段在得分方面的意义。</td>
</tr>
<tr>
<td>default_language</td>
<td>string</td>
<td>对于文本索引，并为词干分析器和标记生成器列表中的语言决定了停用词和规则。它的默认值： english.</td>
</tr>
<tr>
<td>language_override</td>
<td>string</td>
<td>对于一个文本索引，包含在文档中指定字段的名称，语言来覆盖默认语言。它的默认值：language.</td>
</tr>
</tbody>
</table>
<h2 id="MongoDB-聚合"><a href="#MongoDB-聚合" class="headerlink" title="MongoDB 聚合"></a>MongoDB 聚合</h2><p>聚合操作处理数据记录并返回计算结果。从多个文档聚合分组操作数值，并可以执行多种对分组数据业务返回一个结果。 在SQL中的count(*)，使用group by 与mongodb的聚合是等效的。 对于MongoDB的聚合，使用的是aggregate()方法。</p>
<h5 id="语法-18"><a href="#语法-18" class="headerlink" title="语法"></a>语法</h5><p>aggregate()方法的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)</span><br></pre></td></tr></table></figure>
<h5 id="例子-14"><a href="#例子-14" class="headerlink" title="例子"></a>例子</h5><p>在集合中有以下数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   _id: ObjectId(<span class="number">7</span>df78ad8902c)</span><br><span class="line">   title: <span class="string">'MongoDB Overview'</span>, </span><br><span class="line">   description: <span class="string">'MongoDB is no sql database'</span>,</span><br><span class="line">   by_user: <span class="string">'Yiibai Yiibai '</span>,</span><br><span class="line">   url: <span class="string">'http://www.yiibai.com'</span>,</span><br><span class="line">   tags: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   likes: <span class="number">100</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">   _id: ObjectId(<span class="number">7</span>df78ad8902d)</span><br><span class="line">   title: <span class="string">'NoSQL Overview'</span>, </span><br><span class="line">   description: <span class="string">'No sql database is very fast'</span>,</span><br><span class="line">   by_user: <span class="string">'Yiibai Yiibai'</span>,</span><br><span class="line">   url: <span class="string">'http://www.yiibai.com'</span>,</span><br><span class="line">   tags: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   likes: <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">   _id: ObjectId(<span class="number">7</span>df78ad8902e)</span><br><span class="line">   title: <span class="string">'Neo4j Overview'</span>, </span><br><span class="line">   description: <span class="string">'Neo4j is no sql database'</span>,</span><br><span class="line">   by_user: <span class="string">'Neo4j'</span>,</span><br><span class="line">   url: <span class="string">'http://www.neo4j.com'</span>,</span><br><span class="line">   tags: [<span class="string">'neo4j'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   likes: <span class="number">750</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在从上面的集合，如果想知道每一个用户编写的教程是多少，那么使用aggregate()方法，如下图所示的列表：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.mycol.aggregate([&#123;<span class="attr">$group</span> : &#123;<span class="attr">_id</span> : <span class="string">"$by_user"</span>, <span class="attr">num_tutorial</span> : &#123;<span class="attr">$sum</span> : <span class="number">1</span>&#125;&#125;&#125;])</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"result"</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"_id"</span> : <span class="string">"Yiibai Yiibai"</span>,</span><br><span class="line">         <span class="string">"num_tutorial"</span> : <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"_id"</span> : <span class="string">"Neo4j"</span>,</span><br><span class="line">         <span class="string">"num_tutorial"</span> : <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">   ],</span><br><span class="line">   <span class="string">"ok"</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>用于上述用途将等效于sql查询： select by_user, count(*) from mycol group by by_user</p>
<p>另外，在上述例子中，我们已经使用字段by_user进行分组并计算总和，也就是by_user 出现各个次数。一个列表中可用的聚集表达式。</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>$sum</td>
<td>从集合累加所有文档中的定义值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$sum : “$likes”}}}])</td>
</tr>
<tr>
<td>$avg</td>
<td>从集合中的所有文档计算所有给定值的平均值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$avg : “$likes”}}}])</td>
</tr>
<tr>
<td>$min</td>
<td>从集合中获取的所有文件的最小的相应值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$min : “$likes”}}}])</td>
</tr>
<tr>
<td>$max</td>
<td>从集合中的所有文档中的相应值中获取最大值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$max : “$likes”}}}])</td>
</tr>
<tr>
<td>$push</td>
<td>插入数组值到文档中</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, url : {$push: “$url”}}}])</td>
</tr>
<tr>
<td>$addToSet</td>
<td>插入值所产生的数组到文档中，但不会产生重复</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, url : {$addToSet : “$url”}}}])</td>
</tr>
<tr>
<td>$first</td>
<td>从源文件获取根据分组的头文件。通常，这使得只能意会再加上一些以前应用“$sort” -stage</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, first_url : {$first : “$url”}}}])</td>
</tr>
<tr>
<td>$last</td>
<td>从源文件获取根据分组的最后文件。通常，这使得只能意会再加上一些以前应用 “$sort”-stage.</td>
<td>db.mycol.aggregate([{$group : {_id : “$by_user”, last_url : {$last : “$url”}}}])</td>
</tr>
</tbody>
</table>
<h2 id="MongoDB-复制"><a href="#MongoDB-复制" class="headerlink" title="MongoDB 复制"></a>MongoDB 复制</h2><p>复制是同步在多个服务器上的数据过程。复制提供了冗余和数据在不同的数据库服务器上的多个副本提高数据的可用性，复制防止在单个服务器上丢失数据库。 复制也可以从硬件故障和服务中断中恢复。带有数据的其他副本，可以选择其中一个灾难恢复，报告或备份。</p>
<p>为什么要复制？</p>
<ul>
<li>为了让数据安全</li>
<li>数据的高（24*7）可用性</li>
<li>灾难恢复</li>
<li>无停机维护（如备份，索引重建，压缩）</li>
<li>读取缩放（额外的副本来读取）</li>
<li>副本集是透明的应用</li>
</ul>
<h5 id="MongoDB复制的工作原理"><a href="#MongoDB复制的工作原理" class="headerlink" title="MongoDB复制的工作原理"></a>MongoDB复制的工作原理</h5><p>MongoDB通过使用副本集的复制来实现。副本集是一组承载同一个数据集的mongod实例。在副本的一个节点是接收所有的写操作主节点。所有的实例，次级，应用操作从主以便它们具有相同的数据集。副本集只能有一个主节点。</p>
<ul>
<li>副本集是一组两个或更多个节点（通常至少3节点是必需的）。</li>
<li>在副本集一个节点是主节点和其余的节点都是次要的。</li>
<li>所有的数据复制是从主到次节点。</li>
<li>在自动故障转移或维护时，选建立了主要和一个新的主节点被选择。</li>
<li>故障节点的恢复后，再次加入副本集，并可以作为一个辅助节点。</li>
</ul>
<p>mongodb复制的典型图如下图，其中客户端应用程序总是与主节点和主节点交互，然后将数据复制到辅助节点。</p>
<p><img src="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gk1gxifj20dw0bd74v.jpg" alt></p>
<h5 id="副本集特征"><a href="#副本集特征" class="headerlink" title="副本集特征"></a>副本集特征</h5><ul>
<li>N个节点的集群</li>
<li>任何节点可为原发/主节点</li>
<li>所有的写操作进入到主节点</li>
<li>自动故障转移</li>
<li>自动恢复</li>
<li>协商一致选择主节点</li>
</ul>
<h5 id="建立一个副本集"><a href="#建立一个副本集" class="headerlink" title="建立一个副本集"></a>建立一个副本集</h5><p>在本教程中，我们将独立的 mongod 实例转换为副本集。 要转换为副本集，按照以下的步骤：</p>
<ul>
<li>关闭已经运行的 MongoDB 服务器。</li>
<li><p>现在，通过指定–replSet选项启动 MongoDB 服务器。–replSet 的基本语法如下：</p>
</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --port <span class="string">"PORT"</span> --dbpath <span class="string">"YOUR_DB_DATA_PATH"</span> --replSet <span class="string">"REPLICA_SET_INSTANCE_NAME"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --port <span class="number">27017</span> --dbpath <span class="string">"D:\software\MongoDB\Server\3.0\mongodb\data"</span> --replSet rs0</span><br></pre></td></tr></table></figure>
</li>
<li><p>这将启动一个名为rs0的一个mongod实例，端口为： 27017</p>
</li>
<li>现在打开启动命令提示符，然后连接到mongod实例</li>
<li>在Mongo的客户端使用命令rs.initiate()来启动一个新的副本集</li>
<li>要检查副本设置配置，则使用命令rs.conf()</li>
<li>要检查副本集发行的状态，使用命令rs.status()</li>
</ul>
<h2 id="MongoDB创建备份"><a href="#MongoDB创建备份" class="headerlink" title="MongoDB创建备份"></a>MongoDB创建备份</h2><h5 id="MongoDB数据转储"><a href="#MongoDB数据转储" class="headerlink" title="MongoDB数据转储"></a>MongoDB数据转储</h5><p>要使用 mongodump 命令来执行 MongoDB 数据库备份。此命令将转储服务器的所有数据到转储目录。有许多可用的选项，通过它可以限制数据量或创建远程服务器备份。</p>
<h5 id="语法-19"><a href="#语法-19" class="headerlink" title="语法"></a>语法</h5><p>mongodump命令的基本语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mongodump</span><br></pre></td></tr></table></figure>
<h5 id="例子-15"><a href="#例子-15" class="headerlink" title="例子"></a>例子</h5><p>启动 mongod 服务器。假设 mongod 服务器运行在本地主机和端口 27017. 现在打开一个命令提示符，然后转到你的MongoDB实例的bin目录，然后输入命令mongodump。</p>
<p>考虑mycol集合有以下数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mongodump</span><br></pre></td></tr></table></figure>
<p>该命令将连接到服务器127.0.0.1和端口27017，并备份所有数据到服务器上的目录： /bin/dump/. 命令的输出如下所示：</p>
<p><img src="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gpmm3kij20it08aaar.jpg" alt></p>
<p>以上是可用的选项能够与mongodump命令一起使用的列表。</p>
<p>此命令将只备份指定数据库到指定的路径</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>mongodump –host HOST_NAME –port PORT_NUMBER</td>
<td>这个命令将备份指定的mongod实例的所有数据库</td>
<td>mongodump –host yiibai.com –port 27017</td>
</tr>
<tr>
<td>mongodump –dbpath DB_PATH –out BACKUP_DIRECTORY</td>
<td></td>
<td>mongodump –dbpath /data/db/ –out /data/backup/</td>
</tr>
<tr>
<td>mongodump –collection COLLECTION –db DB_NAME</td>
<td>此命令将仅备份指定的特定数据库集合</td>
<td>mongodump –collection mycol –db test</td>
</tr>
</tbody>
</table>
<h5 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h5><p>要恢复备份的MongoDB数据，则使用mongorestore命令。该命令将从备份目录恢复所有的数据。</p>
<h5 id="语法-20"><a href="#语法-20" class="headerlink" title="语法"></a>语法</h5><p>mongorestore命令的基本语法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mongorestore</span><br></pre></td></tr></table></figure>
<p>这个命令的输出如下所示：</p>
<p><img src="http://ww1.sinaimg.cn/large/b3ad6cffly1g25gsbqq7cj20it0cq0tu.jpg" alt></p>

      
    </div>
    
    
    

    <div>
      
        <div> 
   
    <div style="text-align:center;color: #ccc;font-size:14px;">
      -------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------
    </div> 
   
</div>
      
    </div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/mongodb/" rel="tag"><i class="fa fa-tag"></i> mongodb</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/10/javascript/数值/" rel="next" title="Javascript 数据类型(数值)">
                <i class="fa fa-chevron-left"></i> Javascript 数据类型(数值)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/09/javascript/this、call和apply/" rel="prev" title="JavaScript 中的 this、call 和 apply">
                JavaScript 中的 this、call 和 apply <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Dazi">
            
              <p class="site-author-name" itemprop="name">Dazi</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建数据库"><span class="nav-number">1.</span> <span class="nav-text">创建数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子："><span class="nav-number">1.0.0.2.</span> <span class="nav-text">例子：</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#删除数据库"><span class="nav-number">2.</span> <span class="nav-text">删除数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-1"><span class="nav-number">2.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子：-1"><span class="nav-number">2.0.0.2.</span> <span class="nav-text">例子：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建集合"><span class="nav-number">3.</span> <span class="nav-text">创建集合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-2"><span class="nav-number">3.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#选项列表"><span class="nav-number">3.0.0.2.</span> <span class="nav-text">选项列表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-3"><span class="nav-number">3.0.0.3.</span> <span class="nav-text">语法:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除集合"><span class="nav-number">4.</span> <span class="nav-text">删除集合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-4"><span class="nav-number">4.0.0.1.</span> <span class="nav-text">语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入文档"><span class="nav-number">5.</span> <span class="nav-text">插入文档</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-5"><span class="nav-number">5.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子"><span class="nav-number">5.0.0.2.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-1"><span class="nav-number">5.0.0.3.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查询文档"><span class="nav-number">6.</span> <span class="nav-text">查询文档</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-6"><span class="nav-number">6.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-7"><span class="nav-number">6.0.0.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-2"><span class="nav-number">6.0.0.3.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RDBMS-Where子句等效于MongoDB"><span class="nav-number">6.0.0.4.</span> <span class="nav-text">RDBMS Where子句等效于MongoDB</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#AND-在-MongoDB"><span class="nav-number">6.0.0.5.</span> <span class="nav-text">AND 在 MongoDB</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-8"><span class="nav-number">6.0.0.6.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-3"><span class="nav-number">6.0.0.7.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#OR-在-MongoDB"><span class="nav-number">6.0.0.8.</span> <span class="nav-text">OR 在 MongoDB</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-9"><span class="nav-number">6.0.0.9.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-4"><span class="nav-number">6.0.0.10.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用-AND-和-OR-在一起"><span class="nav-number">6.0.0.11.</span> <span class="nav-text">使用 AND 和 OR 在一起</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-5"><span class="nav-number">6.0.0.12.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新文档"><span class="nav-number">7.</span> <span class="nav-text">更新文档</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MongoDB-Update-方法"><span class="nav-number">7.0.0.1.</span> <span class="nav-text">MongoDB Update() 方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-10"><span class="nav-number">7.0.0.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-6"><span class="nav-number">7.0.0.3.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MongoDB-Save-方法"><span class="nav-number">7.0.0.4.</span> <span class="nav-text">MongoDB Save() 方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-11"><span class="nav-number">7.0.0.5.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-7"><span class="nav-number">7.0.0.6.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除文档"><span class="nav-number">8.</span> <span class="nav-text">删除文档</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-12"><span class="nav-number">8.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-8"><span class="nav-number">8.0.0.2.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#只删除一个"><span class="nav-number">8.0.0.3.</span> <span class="nav-text">只删除一个</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#删除所有文件"><span class="nav-number">8.0.0.4.</span> <span class="nav-text">删除所有文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB投影"><span class="nav-number">9.</span> <span class="nav-text">MongoDB投影</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-13"><span class="nav-number">9.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-9"><span class="nav-number">9.0.0.2.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#限制文档"><span class="nav-number">10.</span> <span class="nav-text">限制文档</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MongoDB-Limit-方法"><span class="nav-number">10.0.0.1.</span> <span class="nav-text">MongoDB Limit() 方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-14"><span class="nav-number">10.0.0.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-10"><span class="nav-number">10.0.0.3.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MongoDB-Skip-方法"><span class="nav-number">10.0.0.4.</span> <span class="nav-text">MongoDB Skip() 方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-15"><span class="nav-number">10.0.0.5.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-11"><span class="nav-number">10.0.0.6.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文档排序"><span class="nav-number">11.</span> <span class="nav-text">文档排序</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-16"><span class="nav-number">11.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-12"><span class="nav-number">11.0.0.2.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB索引"><span class="nav-number">12.</span> <span class="nav-text">MongoDB索引</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-17"><span class="nav-number">12.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-13"><span class="nav-number">12.0.0.2.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB-聚合"><span class="nav-number">13.</span> <span class="nav-text">MongoDB 聚合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-18"><span class="nav-number">13.0.0.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-14"><span class="nav-number">13.0.0.2.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB-复制"><span class="nav-number">14.</span> <span class="nav-text">MongoDB 复制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MongoDB复制的工作原理"><span class="nav-number">14.0.0.1.</span> <span class="nav-text">MongoDB复制的工作原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#副本集特征"><span class="nav-number">14.0.0.2.</span> <span class="nav-text">副本集特征</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#建立一个副本集"><span class="nav-number">14.0.0.3.</span> <span class="nav-text">建立一个副本集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB创建备份"><span class="nav-number">15.</span> <span class="nav-text">MongoDB创建备份</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MongoDB数据转储"><span class="nav-number">15.0.0.1.</span> <span class="nav-text">MongoDB数据转储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-19"><span class="nav-number">15.0.0.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#例子-15"><span class="nav-number">15.0.0.3.</span> <span class="nav-text">例子</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数据恢复"><span class="nav-number">15.0.0.4.</span> <span class="nav-text">数据恢复</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-20"><span class="nav-number">15.0.0.5.</span> <span class="nav-text">语法</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dazi</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">24.4k</span>
  
</div>









<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共24.4k字</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'GmhCbIK6Tl9AvmbG1wEHcmz9-gzGzoHsz',
        appKey: 'fbhIkUvB75LUnXkSr3D8xICp',
        placeholder: '说点儿什么吧 (*+*)',
        avatar:'Dazi',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("GmhCbIK6Tl9AvmbG1wEHcmz9-gzGzoHsz", "fbhIkUvB75LUnXkSr3D8xICp");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":100,"height":100},"mobile":{"show":false},"log":false});</script></body>
</html>
